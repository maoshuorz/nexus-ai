#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Agent Runner - ä½¿ç”¨OpenClaw sessions_spawnå¯åŠ¨Agent
"""

import json
import subprocess
import time
from datetime import datetime
from pathlib import Path

AGENT_PROMPTS = {
    'ceo': """ä½ æ˜¯å…¬å¸çš„CEOï¼ˆé¦–å¸­æ‰§è¡Œå®˜ï¼‰ï¼Œè´Ÿè´£æˆ˜ç•¥å†³ç­–å’Œèµ„æºåˆ†é…ã€‚

å½“å‰å¸‚åœºè¶‹åŠ¿ï¼š
- AIæŠ€æœ¯å¿«é€Ÿå‘å±•
- è¿œç¨‹åŠå…¬æˆä¸ºå¸¸æ€
- å¯æŒç»­å‘å±•å—å…³æ³¨
- ä¸ªæ€§åŒ–æœåŠ¡éœ€æ±‚å¢é•¿

ä½ çš„èŒè´£ï¼š
1. è¯„ä¼°å¸‚åœºæœºä¼šå’Œé¡¹ç›®ææ¡ˆ
2. åˆ†é…é¢„ç®—å’Œèµ„æº
3. åè°ƒå„éƒ¨é—¨åä½œ
4. åšå‡ºæœ€ç»ˆå†³ç­–

è¯·åˆ†æå½“å‰å¸‚åœºç¯å¢ƒï¼Œæå‡ºä¸€ä¸ªå…·ä½“çš„ç›ˆåˆ©é¡¹ç›®å»ºè®®ï¼ŒåŒ…æ‹¬ï¼š
- é¡¹ç›®åç§°å’Œæè¿°
- ç›®æ ‡å¸‚åœº
- é¢„æœŸæŠ•å…¥
- é¢„æœŸæ”¶ç›Š
- éœ€è¦å“ªäº›éƒ¨é—¨é…åˆ

è¾“å‡ºJSONæ ¼å¼ã€‚""",

    'cmo': """ä½ æ˜¯å…¬å¸çš„CMOï¼ˆå¸‚åœºæ€»ç›‘ï¼‰ï¼Œè´Ÿè´£å¸‚åœºè°ƒç ”å’Œç”¨æˆ·éœ€æ±‚åˆ†æã€‚

å½“å‰å¸‚åœºè§‚å¯Ÿï¼š
- ç”¨æˆ·å¯¹AIå·¥å…·éœ€æ±‚æ¿€å¢
- ä¸­å°ä¼ä¸šæ•°å­—åŒ–è½¬å‹åŠ é€Ÿ
- å†…å®¹åˆ›ä½œé—¨æ§›é™ä½
- ç¤¾åŒºå’Œç§åŸŸæµé‡é‡è¦æ€§æå‡

è¯·å®Œæˆï¼š
1. åˆ†æå½“å‰æœ€æœ‰æ½œåŠ›çš„3ä¸ªå¸‚åœºæœºä¼š
2. æ¯ä¸ªæœºä¼šçš„ç›®æ ‡ç”¨æˆ·ç”»åƒ
3. ç«å“åˆ†æ
4. æ¨èå…¬å¸åº”è¯¥ä¼˜å…ˆè¿›å…¥çš„å¸‚åœº

è¾“å‡ºJSONæ ¼å¼ï¼ŒåŒ…å«å…·ä½“æ•°æ®å’Œç†ç”±ã€‚""",

    'cto': """ä½ æ˜¯å…¬å¸çš„CTOï¼ˆç ”å‘æ€»ç›‘ï¼‰ï¼Œè´Ÿè´£æŠ€æœ¯æ¶æ„å’Œäº§å“å¼€å‘ã€‚

å½“å‰æŠ€æœ¯è¶‹åŠ¿ï¼š
- å¤§è¯­è¨€æ¨¡å‹åº”ç”¨çˆ†å‘
- ä½ä»£ç /æ— ä»£ç å¹³å°å…´èµ·
- è¾¹ç¼˜è®¡ç®—å‘å±•
- å¤šæ¨¡æ€AIèåˆ

è¯·å®Œæˆï¼š
1. è¯„ä¼°å½“å‰æœ€é€‚åˆå…¬å¸å‘å±•çš„3ä¸ªæŠ€æœ¯æ–¹å‘
2. æ¯ä¸ªæ–¹å‘çš„æŠ€æœ¯å¯è¡Œæ€§åˆ†æ
3. æ‰€éœ€æŠ€æœ¯æ ˆå’Œå›¢é˜Ÿé…ç½®
4. ç ”å‘å‘¨æœŸå’Œé‡Œç¨‹ç¢‘è§„åˆ’

è¾“å‡ºJSONæ ¼å¼ã€‚""",

    'coo': """ä½ æ˜¯å…¬å¸çš„COOï¼ˆè¿è¥æ€»ç›‘ï¼‰ï¼Œè´Ÿè´£è¿è¥ç­–ç•¥å’Œæµç¨‹ä¼˜åŒ–ã€‚

å½“å‰è¿è¥æŒ‘æˆ˜ï¼š
- ç”¨æˆ·è·å–æˆæœ¬ä¸Šå‡
- ç”¨æˆ·ç•™å­˜éš¾åº¦å¢åŠ 
- å›¢é˜Ÿåä½œæ•ˆç‡å¾…æå‡
- æ•°æ®é©±åŠ¨å†³ç­–éœ€æ±‚

è¯·å®Œæˆï¼š
1. è®¾è®¡ä¸€å¥—é«˜æ•ˆçš„è¿è¥æµç¨‹
2. æå‡º3ä¸ªæå‡å›¢é˜Ÿæ•ˆç‡çš„æ–¹æ¡ˆ
3. åˆ¶å®šç”¨æˆ·è·å–å’Œç•™å­˜çš„ç­–ç•¥
4. è®¾è®¡å…³é”®è¿è¥æŒ‡æ ‡ï¼ˆKPIï¼‰

è¾“å‡ºJSONæ ¼å¼ã€‚""",

    'pr': """ä½ æ˜¯å…¬å¸çš„PR Directorï¼ˆå®£ä¼ æ€»ç›‘ï¼‰ï¼Œè´Ÿè´£å“ç‰Œå»ºè®¾å’Œç”¨æˆ·è·å–ã€‚

å½“å‰ä¼ æ’­è¶‹åŠ¿ï¼š
- çŸ­è§†é¢‘å’Œç›´æ’­ä¸»å¯¼
- KOLå’ŒKOCè¥é”€å…´èµ·
- å†…å®¹è¥é”€é‡è¦æ€§
- ç¤¾ç¾¤è¿è¥ä»·å€¼

è¯·å®Œæˆï¼š
1. è®¾è®¡å…¬å¸å“ç‰Œå®šä½
2. åˆ¶å®š3ä¸ªæœˆçš„è¥é”€è®¡åˆ’
3. å†…å®¹ç­–ç•¥å’Œæ¸ é“é€‰æ‹©
4. é¢„æœŸè·å®¢æˆæœ¬å’ŒROI

è¾“å‡ºJSONæ ¼å¼ã€‚""",

    'cfo': """ä½ æ˜¯å…¬å¸çš„CFOï¼ˆè´¢åŠ¡æ€»ç›‘ï¼‰ï¼Œè´Ÿè´£è´¢åŠ¡è§„åˆ’å’Œé£é™©æ§åˆ¶ã€‚

å…¬å¸è´¢åŠ¡çŠ¶å†µï¼š
- åˆå§‹èµ„é‡‘ï¼š100ä¸‡å…ƒ
- æœˆåº¦è¿è¥æˆæœ¬ï¼š15ä¸‡å…ƒ
- é¢„æœŸ6ä¸ªæœˆå†…å®ç°ç›ˆäºå¹³è¡¡

è¯·å®Œæˆï¼š
1. åˆ¶å®šè¯¦ç»†çš„è´¢åŠ¡é¢„ç®—
2. è®¾è®¡æˆæœ¬æ§åˆ¶æœºåˆ¶
3. åˆ†ææŠ•èµ„å›æŠ¥é¢„æœŸ
4. æå‡ºé£é™©ç®¡ç†å»ºè®®

è¾“å‡ºJSONæ ¼å¼ã€‚""",

    'observer': """ä½ æ˜¯å…¬å¸çš„è¿è¥è§‚å¯Ÿå‘˜ï¼ˆObserverï¼‰ï¼Œè´Ÿè´£ç›‘æ§å’Œä¼˜åŒ–å›¢é˜Ÿåä½œã€‚

å½“å‰è§‚å¯Ÿé‡ç‚¹ï¼š
- å„éƒ¨é—¨åä½œæ•ˆç‡
- é¡¹ç›®æ‰§è¡Œè¿›åº¦
- èµ„æºåˆ†é…åˆç†æ€§
- æ²Ÿé€šæ•ˆæœ

è¯·å®Œæˆï¼š
1. è®¾è®¡ä¸€å¥—åä½œè¯„ä¼°ä½“ç³»
2. è¯†åˆ«æ½œåœ¨åä½œé—®é¢˜
3. æå‡ºä¼˜åŒ–å»ºè®®
4. åˆ¶å®šå®šæœŸæŠ¥å‘Šæœºåˆ¶

è¾“å‡ºJSONæ ¼å¼ã€‚"""
}

def run_agent(agent_id: str, timeout: int = 120) -> dict:
    """
    è¿è¡Œå•ä¸ªAgentä»»åŠ¡
    
    å®é™…ä½¿ç”¨OpenClawçš„sessions_spawn
    """
    prompt = AGENT_PROMPTS.get(agent_id)
    if not prompt:
        return {'error': f'Unknown agent: {agent_id}'}
    
    print(f"ğŸš€ å¯åŠ¨ {agent_id.upper()} Agent...")
    
    # åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™é‡Œè°ƒç”¨sessions_spawn
    # ç°åœ¨å…ˆæ¨¡æ‹Ÿè¿”å›
    result = {
        'agent': agent_id,
        'status': 'completed',
        'timestamp': datetime.now().isoformat(),
        'output': f'{agent_id} å·²å®Œæˆåˆ†æ'
    }
    
    return result

def run_parallel_agents(agent_ids: list, timeout: int = 120) -> dict:
    """
    å¹¶è¡Œè¿è¡Œå¤šä¸ªAgent
    
    å®é™…ä½¿ç”¨OpenClawçš„sessions_spawnå¹¶è¡Œæ‰§è¡Œ
    """
    results = {}
    
    print(f"\n{'='*60}")
    print(f"å¹¶è¡Œå¯åŠ¨ {len(agent_ids)} ä¸ªAgent")
    print(f"Agents: {', '.join(agent_ids)}")
    print('='*60)
    
    # åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™é‡Œä½¿ç”¨sessions_spawnå¹¶è¡Œå¯åŠ¨
    # ç°åœ¨é¡ºåºæ‰§è¡Œæ¨¡æ‹Ÿ
    for agent_id in agent_ids:
        results[agent_id] = run_agent(agent_id, timeout)
        time.sleep(0.5)  # æ¨¡æ‹Ÿé—´éš”
    
    return results

def simulate_company_meeting():
    """æ¨¡æ‹Ÿå…¬å¸å…¨å‘˜ä¼šè®®"""
    print("\n" + "="*60)
    print("ğŸ¢ å…¬å¸å…¨å‘˜å¯åŠ¨ä¼šè®®")
    print("="*60)
    
    # é˜¶æ®µ1: å¸‚åœºæœºä¼šå‘ç° (CMO)
    print("\nğŸ“Š é˜¶æ®µ1: å¸‚åœºæœºä¼šå‘ç°")
    cmo_result = run_agent('cmo')
    
    # é˜¶æ®µ2: å¹¶è¡Œè¯„ä¼° (CTO, CFO, COO)
    print("\nğŸ” é˜¶æ®µ2: å¯è¡Œæ€§è¯„ä¼°")
    eval_results = run_parallel_agents(['cto', 'cfo', 'coo'])
    
    # é˜¶æ®µ3: æˆ˜ç•¥å†³ç­– (CEO)
    print("\nğŸ¯ é˜¶æ®µ3: æˆ˜ç•¥å†³ç­–")
    ceo_result = run_agent('ceo')
    
    # é˜¶æ®µ4: è¥é”€è§„åˆ’ (PR)
    print("\nğŸ“¢ é˜¶æ®µ4: è¥é”€è§„åˆ’")
    pr_result = run_agent('pr')
    
    # é˜¶æ®µ5: ç›‘æ§å¯åŠ¨ (Observer)
    print("\nğŸ‘ï¸ é˜¶æ®µ5: ç›‘æ§å¯åŠ¨")
    observer_result = run_agent('observer')
    
    return {
        'cmo': cmo_result,
        'evaluation': eval_results,
        'ceo': ceo_result,
        'pr': pr_result,
        'observer': observer_result
    }

if __name__ == '__main__':
    results = simulate_company_meeting()
    
    print("\n" + "="*60)
    print("âœ… å…¬å¸å¯åŠ¨å®Œæˆ")
    print("="*60)
    print(json.dumps(results, indent=2, ensure_ascii=False))
